import requests
import random
import logging

TRAKT_CLIENT_ID = "TRAKT_CLIENT_ID"

logger = logging.getLogger(__name__)

def get_random_movie_by_genre(genre, people):
    headers = {
        "Content-Type": "application/json",
        "trakt-api-version": "2",
        "trakt-api-key": TRAKT_CLIENT_ID,
    }
    try:
        # Пример запроса топ фильмов по жанру
        url = f"https://api.trakt.tv/movies/popular"
        params = {
            "genres": genre,
            "limit": 50,
            "extended": "full",
        }
        response = requests.get(url, headers=headers, params=params)
        response.raise_for_status()
        movies = response.json()
        if not movies:
            return None
        movie = random.choice(movies)

        # Формируем словарь с нужными полями
        result = {
            "title": movie.get("title", "Nav nosaukuma"),
            "year": movie.get("year", ""),
            "genres": ", ".join(movie.get("genres", [])) if movie.get("genres") else "Nav žanru",
            "overview": movie.get("overview", "Apraksts nav pieejams."),
            "trakt_url": f"https://trakt.tv/movies/{movie.get('ids', {}).get('slug', '')}"
        }
        return result
    except Exception as e:
        logger.error(f"Kļūda trakt API: {e}")
        return None
